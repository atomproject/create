var dragAndDropSetup=function(){var e=localStorage.getItem("atom-builder"),t=document.querySelector("t-stage");localStorage.removeItem("atom-builder"),e&&(t.reset(),t.recreateBuilder(e)),$(".control").draggable({addClasses:!1,scroll:!1,appendTo:"body",helper:"clone",cursor:"move",revert:"invalid"}),t.addEventListener("component-panel-changed",function(e){var t=e.detail.name,n=document.getElementById("panelSettings");n.disabled="t-page"===t||"t-form"===t}),$("#uploadJson").on("click",function(){document.querySelector("#uploadInput").click()}),$("#canvasRefresh").on("click",function(){var e,n,a;if(t){n=t.builderState,a=t._elementSateList;try{e=t.getStateFile(n,a),localStorage.setItem("atom-builder",e)}catch(o){}finally{window.location.reload()}}}),$("#uploadInput").on("change",function(){var e,n=this.files,a=new FileReader,o="Builder restored to the state.json successfully.";return n=Array.prototype.slice.call(n),(e=n.find(function(e){return e.name.match(/^[^\.]+\.json/i)}))?(a.addEventListener("load",function(e){t.reset();try{t.recreateBuilder(e.target.result)}catch(n){o="The syntax of state file is not valid."}app.$.toast.text=o,app.$.toast.open()}),void a.readAsText(e)):(app.$.toast.text="Not a json file. You can only upload a json file.",void app.$.toast.open())}),$("#downloadZip").on("click",function(){var e=new JSZip;t&&t.getDownloadFiles().then(function(t){var n;e.file(t.name,t.builderFile),e.file("state.json",t.stateFile),e.file("bower.json",t.bowerFile),t.demoFile&&e.folder("demo").file("index.html",t.demoFile),n=e.generate({type:"blob"}),saveAs(n,t.name.replace(".html",".zip"))})["catch"](function(e){app.$.toast.text=e.toString(),app.$.toast.open()})}),$("#downloadJson").on("click",function(){var e,n,a,o;if(t){a=t.builderState,o=t._elementSateList;try{e=t.getStateFile(a,o),n=new Blob([e],{type:"text/plain;charset=utf-8"}),saveAs(n,"state.json")}catch(r){app.$.toast.text=r.toString(),app.$.toast.open()}}}),$("#panelSettings").on("click",function(){t.showPanelForBuilder()}),$("body").on("click",".control",function(e){var n=e.currentTarget.getAttribute("data-category"),a=e.currentTarget.getAttribute("data-component");t.addToBuilder(a,n)}),$(".component-list").on("click","paper-item.menu-item",function(){$(".component-list").toggleClass("active")}),$("t-stage").on("builder-name-changed",function(e){$(".headerText").text(e.originalEvent.detail)}),$(".headerText").on("keydown",function(e){13===e.which&&($(this).blur(),window.getSelection().removeAllRanges())}),$(".headerText").on("focus",function(){function e(e){var t=document.createRange();t.selectNodeContents(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}var t=this;$(this).removeClass("inactive"),requestAnimationFrame(function(){e(t)})}),$(".headerText").on("blur",function(){var e=$(this).text().trim(),n=e.toLowerCase().replace(/\s+/g,"-"),a=$(this);0===e.length?a.hasClass("form-header")?a.text("Untitled Form"):a.text("Untitled Page"):(t.updateBuilderState("heading",e),t.updateBuilderState("name",n)),this.scrollLeft=0,a.addClass("inactive")})};!function(e){"use strict";var t=e.querySelector("#app"),n=window.location.pathname.replace("/create","");t.baseUrl="",t.menu=null,""===window.location.port&&(t.baseUrl="/create"),"/page"===n?(t.builderType="t-page",t.isPage=!0,t.builderUrl="page-manifest.json",t.canvasName="Untitled Page",t.tab="page",t.route="canvas"):"/form"===n?(t.builderType="t-form",t.isPage=!1,t.builderUrl="form-manifest.json",t.canvasName="Untitled Form",t.tab="form",t.route="canvas"):"/"===n&&(t.tab="form",t.route="browser"),t._getElementsInCategory=function(e){var n=t.menu.elements.filter(function(t){return t.category===e.name});return n},t.filterComponents=function(e,n){var a;return e?($(".component-list").hasClass("active")||($(".component-list").addClass("active"),$("#allElements").addClass("active")),a=n?t.menu.elements.filter(function(e){return e.category===n}):t.menu.elements,e=e.toLowerCase(),function(t){var n=t.displayName.toLowerCase();return-1!==n.indexOf(e)}):null},t._getIcon=function(e){return e?"fusion:"+e:"fusion-b:atom-logo"},t._getPropertySource=function(){return"bower_components/"+t.builderType+"/property.json"},t.toggleAccordion=function(t){var n=t.currentTarget,a=e.querySelector(".menu-item.active");n.classList.contains("active")?n.classList.remove("active"):n.classList.add("active"),a&&a.classList.remove("active")},t._onElementsReceived=function(e){t.menu=e.detail.response,setTimeout(dragAndDropSetup)},t.displayInstalledToast=function(){Polymer.dom(e).querySelector("platinum-sw-cache").disabled||Polymer.dom(e).querySelector("#caching-complete").show()},t.addEventListener("dom-change",function(){t.$.manifestAjax&&t.$.manifestAjax.generateRequest()}),window.addEventListener("WebComponentsReady",function(){var e=$("t-component-panel")[0],t=$("t-stage")[0];t.componentPanel=e})}(document);