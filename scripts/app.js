var dragAndDropSetup=function(){$(".control").draggable({addClasses:!1,scroll:!1,appendTo:"body",helper:"clone",cursor:"move",revert:"invalid"}),$("#uploadJson").on("click",function(){document.querySelector("#uploadInput").click()}),$("#uploadInput").on("change",function(){var e,t=document.querySelector("t-stage"),n=this.files,o=new FileReader;return n=Array.prototype.slice.call(n),(e=n.find(function(e){return"state.json"===e.name}))?(o.addEventListener("load",function(e){t.reset(),t.recreateBuilder(e.target.result),app.$.toast.text="Builder restored to the state.json successfully.",app.$.toast.open()}),void o.readAsText(e)):(app.$.toast.text="Not state.json file. You can only upload state.json file.",void app.$.toast.open())}),$("#downloadZip").on("click",function(){var e=new JSZip,t=document.querySelector("t-stage");t&&t.getDownloadFiles().then(function(t){var n;e.file(t.name,t.contents),e.file(t.stateFileName,t.stateFile),n=e.generate({type:"blob"}),saveAs(n,t.name.replace(".html",".zip"))})}),$("#downloadJson").on("click",function(){var e,t,n=document.querySelector("t-stage");n&&(e=n.getStateFile(n.builderState,n._elementSateList),t=new Blob([e],{type:"text/plain;charset=utf-8"}),saveAs(t,"state.json"))}),$("body").on("click",".control",function(e){var t=document.querySelector("t-stage"),n=e.currentTarget.getAttribute("data-category"),o=e.currentTarget.getAttribute("data-component");t.addToBuilder(o,n)}),$(".component-list").on("click","paper-item.menu-item",function(){$(".component-list").toggleClass("active")}),$("t-stage").on("builder-name-changed",function(e){$(".headerText").text(e.originalEvent.detail)}),$(".headerText").on("keydown",function(e){13===e.which&&($(this).blur(),window.getSelection().removeAllRanges())}),$(".headerText").on("focus",function(){function e(e){var t=document.createRange();t.selectNodeContents(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}var t=this;$(this).removeClass("inactive"),requestAnimationFrame(function(){e(t)})}),$(".headerText").on("blur",function(){var e=document.querySelector("t-stage"),t=$(this).text().trim(),n=t.toLowerCase().replace(/\s+/,"-"),o=$(this);0===t.length?o.hasClass("form-header")?o.text("Untitled Form"):o.text("Untitled Page"):(e.updateBuilderState("heading",t),e.updateBuilderState("name",n)),this.scrollLeft=0,o.addClass("inactive")})};!function(e){"use strict";var t=e.querySelector("#app"),n=window.location.pathname.replace("/create","");t.baseUrl="",t.menu=null,""===window.location.port&&(t.baseUrl="/create"),"/page"===n?(t.builderType="t-page",t.isPage=!0,t.builderUrl="page-manifest.json",t.canvasName="Untitled Page",t.tab="page",t.route="canvas",window.onbeforeunload=function(e){return"Please make sure that you have downloaded your page"}):"/form"===n?(t.builderType="t-form",t.isPage=!1,t.builderUrl="form-manifest.json",t.canvasName="Untitled Form",t.tab="form",t.route="canvas",window.onbeforeunload=function(e){return"Please make sure that you have downloaded your form"}):"/"===n&&(t.tab="form",t.route="browser"),t._getElementsInCategory=function(e){var n=t.menu.elements.filter(function(t){return t.category===e.name});return n},t.filterComponents=function(e,n){var o;return e?(o=n?t.menu.elements.filter(function(e){return e.category===n}):t.menu.elements,e=e.toLowerCase(),function(t){var n=t.displayName.toLowerCase();return-1!==n.indexOf(e)}):null},t._getIcon=function(e){return e?"fusion:"+e:"fusion-b:atom-logo"},t._getPropertySource=function(e){return"bower_components/"+t.builderType+"/property.json"},t.toggleAccordion=function(t,n,o){var a=t.currentTarget,r=e.querySelector(".menu-item.active");a.classList.contains("active")?a.classList.remove("active"):a.classList.add("active"),r&&r.classList.remove("active")},t._onElementsReceived=function(e){t.menu=e.detail.response,setTimeout(dragAndDropSetup)},t.displayInstalledToast=function(){Polymer.dom(e).querySelector("platinum-sw-cache").disabled||Polymer.dom(e).querySelector("#caching-complete").show()},t.addEventListener("dom-change",function(){t.$.manifestAjax&&t.$.manifestAjax.generateRequest()}),window.addEventListener("WebComponentsReady",function(){var e=$("t-component-panel")[0],t=$("t-stage")[0];t.componentPanel=e})}(document);