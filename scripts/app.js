var dragAndDropSetup=function(){function e(e){var t=p[0];$(e.target).closest(".field-container").remove();var o="formComponents";t.classList.contains("page")&&(o="pageComponents"),i(t.tagName,t,o),0===$(".form").children(".field-container").length&&$(".canvas").addClass("empty"),e.stopImmediatePropagation(),setTimeout(function(){p[0].setFields()},0)}function t(e){var t=$(e.target).closest(".field-container"),o=Polymer.dom(t[0]).innerHTML,n='<li title="Click to Edit. Drag to Reorder." class="horizontal flex layout field-container">';t.hasClass("grouped")&&(n='<li title="Click to Edit. Drag to Reorder." class="horizontal grouped flex layout field-container">'),o=n+o+"</li>",t.after(o)}function o(e){var t=$(e.target).closest(".field-container"),o=t.children(".fieldset"),n='<div class="hover-panel"><iron-icon class="unmerge" title="Unmerge this item" icon="communication:call-split"></iron-icon><iron-icon class="duplicate" title="Clone this item" icon="content-copy"></iron-icon><iron-icon class="close" title="Remove this item" icon="close"></iron-icon></div>',i='<div class="overlap">'+n+"</div>",a=o.length;o.each(function(e){var n=o[a-e-1].getAttribute("data-category"),r='<li class="horizontal flex layout field-container">'+i+'<div class="fieldset flex" data-category="'+n+'">'+Polymer.dom(o[a-e-1]).innerHTML+"</div></li>";t.after(r)}),t.remove()}function n(e){$(".canvas").hasClass("empty")&&$(".canvas").removeClass("empty");document.querySelector("#controlCall");$.ajax({url:"bower_components/"+g+"/demo/metadata.html",crossDomain:!0}).done(function(t){r(t,e)}).fail(function(e){alert("Error while connecting to server")})}function i(e,t,o){var n=document.querySelector("t-component-panel");n.component=e,n.targetComponent=t,a(t),n.propertySource="bower_components/"+e.toLowerCase()+"/property.json",n.setPanel(),"t-form"!==e.toLowerCase()&&"t-page"!==e.toLowerCase()||0===$(".canvas .fieldset").length?$(".property-panel-Header").hide():$(".property-panel-Header").show();var i=document.getElementById("propertyDrawerPanel");"main"===i.selected&&i.togglePanel()}function a(e){if(""===e.name){var t=e.tagName.toLowerCase().slice(2);e.name=(t+p[0].querySelectorAll(e.tagName).length).toLowerCase()}}function r(e,t){if(null!=e){var o=document.createElement("li");o.title="Click to Edit. Drag to Reorder.",o.className="horizontal flex layout field-container";var n=document.createElement("div");n.className="flex fieldset ",n.setAttribute("data-category",t),n.innerHTML=e;var i='<div class="hover-panel"><iron-icon class="unmerge" title="Unmerge this item" icon="communication:call-split"></iron-icon><iron-icon class="duplicate" title="Clone this item" icon="content-copy"></iron-icon><iron-icon class="close" title="Remove this item" icon="close"></iron-icon></div>';$(o).append('<div class="overlap">'+i+"</div>"),o.appendChild(n),d.append(o),"t-form"===p[0].tagName.toLowerCase()&&setTimeout(function(){p[0].setFields()},0),$(n).trigger("click")}}function l(e){return e=e=e.replace("\n",""),e=e.replace(new RegExp('<div title="Click to Edit. Drag to Reorder." class="page canvas vertical layout flex">',"g"),""),e=e.replace(new RegExp('<span class="dextop">Click on an element or drag it here to start building your form.</span>',"g"),""),e=e.replace(new RegExp('<span class="mobile">Browse elements using the button above to start building your form.</span>',"g"),""),e=e.replace(new RegExp('<span class="dextop">Click on an element or drag it here to start building your page.</span>',"g"),""),e=e.replace(new RegExp('<span class="mobile">Browse elements using the button above to start building your page.</span>',"g"),""),e=e.replace(new RegExp('<h2 class="drag-text">',"g"),""),e=e.replace(new RegExp("</h2>","g"),""),e=e.replace(new RegExp("<ul","g"),"<div"),e=e.replace(new RegExp("ul>","g"),"div>"),e=e.replace(new RegExp("<li","g"),"<div"),e=e.replace(new RegExp("li>","g"),"div>"),e=e.replace(new RegExp("x-scope","g"),""),e=e.replace(new RegExp("iron-icon-0","g"),""),e=e.replace(new RegExp("  ","g"),""),e=e.replace(new RegExp('<div class="hover-panel"><iron-icon class="unmerge" title="Unmerge this item" icon="communication:call-split"></iron-icon><iron-icon class="duplicate" title="Clone this item" icon="content-copy"></iron-icon><iron-icon class="close" title="Remove this item" icon="close"></iron-icon></div>',"g"),""),e=e.replace(new RegExp('<div class="overlap" style="z-index: 10;"></div>',"g"),""),e=e.replace(new RegExp('<div class="overlap"></div>',"g"),""),e=e.replace(new RegExp('title="Click to Edit. Drag to Reorder."',"g"),""),e=e.replace(new RegExp('title="Click to edit form properties."',"g"),""),e=e.replace(new RegExp("sortable empty connectedSortable field-container ui-droppable ui-sortable","g"),""),e=e.replace(new RegExp("field-container","g"),""),e=e.replace(new RegExp("t-page","g"),"div")}function c(){var e=p[0],t=l(Polymer.dom(e.parentNode).innerHTML);if("t-form"===e.tagName.toLowerCase()){t=m(t,e.name);var o=s(t,e.name)}else t='<html><head><link rel="import" href="'+u+'"app/elements.html"><link rel="import" href="theme.html"></head><body>'+t+"</body></html>";var n=new JSZip;n.file(e.name+".html",t),"t-form"===e.tagName.toLowerCase()&&n.folder("demo").file("index.html",o);var i=n.generate({type:"blob"});saveAs(i,e.name+".zip")}function s(e,t){return'<html><head><link rel="import" href="'+u+'bower_components/t-shared-components/theme.html"><link rel="import" href="../'+t+'.html"></head><body><'+t+"></"+t+"></body></html>"}function m(e,t){var o='<link rel="import" href="'+u+'bower_components/polymer/polymer.html"></link><link rel="import" href="'+u+'bower_components/t-form/t-form.html"></link>',n='<dom-module id="'+t+'"><template>'+e+"</template></dom-module>",i='<script>Polymer({is: "'+t+'"});</script>';return o+n+i}var d=$(".form"),p=$(".canvas"),g=null,u="https://atomproject.github.io/fusion/";$(".control").draggable({addClasses:!1,scroll:!1,appendTo:"body",helper:"clone",cursor:"move",revert:"invalid",drag:function(e,t){g=t.helper.attr("data-component")}}),d.droppable({drop:function(e,t){t.draggable.hasClass("ui-sortable-helper")||(g=t.draggable[0].getAttribute("data-component"),n(t.draggable[0].getAttribute("data-category")))}}),d.nestedSortable({placeholder:" flex placeholder-highlight",maxLevels:2,tabSize:0,scroll:!1,tolerance:"pointer",branchClass:"grouped",hoveringClass:"placeholder-highlight",listType:"ul",sort:function(e,t){t.placeholder.height(t.helper.height())},relocate:function(e,t){t.item.parent().hasClass("form")?t.item.children(".fieldset")[0].innerHTML=Polymer.dom(t.item.children(".fieldset")[0]).innerHTML:(t.item.unwrap(),t.item.children(".overlap").remove(),t.item.addClass("flex"),t.item.parent("li").addClass("grouped"),t.item=t.item.children(".fieldset").unwrap(),t.item.html(Polymer.dom(t.item[0]).innerHTML))},beforeStop:function(e,t){return t.item.children(".fieldset")[0].innerHTML=Polymer.dom(t.item.children(".fieldset")[0]).innerHTML,!0},isAllowed:function(e,t,o){return!0}}),document.addEventListener("adjust-dom",function(){var e=document.querySelector(".form");$(".form").html(Polymer.dom(e).innerHTML)}),document.addEventListener("on-autosuggest-select",function(e){var t=e.detail;g=t.selectedItem.Name,n(t.selectedItem.Category),t.$.autoSuggest.value="",t.$.autoSuggest.blur(),e.stopPropagation()}),d.on("click",".fieldset",function(e){var t=e.currentTarget.children[0],o=t.tagName.toLowerCase(),n=this.getAttribute("data-category");i(o,t,n),e.stopImmediatePropagation()}),d.on("click",".overlap",function(e){$(".overlap").css("z-index","0"),$(document.elementFromPoint(e.pageX,e.pageY)).closest(".fieldset").click(),$(".overlap").css("z-index","10"),e.stopImmediatePropagation()}),d.on("click",".close",function(t){e(t)}),d.on("click",".duplicate",function(e){t(e),e.stopImmediatePropagation()}),d.on("click",".unmerge",function(e){o(e),e.stopImmediatePropagation(),e.preventDefault()}),$("#preview").on("click",function(){var e=$("#htmlContent");e.attr("target","_blank"),$("#htmlContent").submit(),event.preventDefault()}),$("#download").on("click",function(){c()}),$("body").on("click",".control",function(e){g=e.currentTarget.getAttribute("data-component"),n(e.currentTarget.getAttribute("data-category"))}),$(".component-list").on("click","paper-item.menuitem",function(){$(this).add(".component-list").toggleClass("active")}),$(".main-body , .form").on("click",function(e){var t=p[0],o="formComponents";t.classList.contains("page")&&(o="pageComponents"),i(t.tagName,t,o),e.stopImmediatePropagation()}),$(".paper-header").on("click",function(e){var t=p[0],o="formComponents";t.classList.contains("page")&&(o="pageComponents"),i(t.tagName,t,o),$(".property-panel-Header").show(),e.stopImmediatePropagation()}),$(".headerText").on("keydown",function(e){13===e.which&&($(this).blur(),window.getSelection().removeAllRanges())}),$(".headerText").on("focus",function(){function e(e){var t=document.createRange();t.selectNodeContents(e);var o=window.getSelection();o.removeAllRanges(),o.addRange(t)}$(this).removeClass("inactive");var t=this;requestAnimationFrame(function(){e(t)})}),$(".headerText").on("blur",function(){0===$(this).text().trim().length&&($(this).hasClass("form-header")?$(this).text("Untitled Form"):$(this).text("Untitled Page")),this.scrollLeft=0,$(this).addClass("inactive")}),$(document).on("keydown","#componentSearch",function(e){9===e.keyCode&&e.preventDefault()})};!function(e){"use strict";var t=e.querySelector("#app");t.baseUrl="/",t.menu=null,""===window.location.port&&(t.baseUrl="/fusion/"),t._getElementsInCategory=function(e){var o=t.menu.elements.filter(function(t){return t.category===e.name});return o},t._getPropertySource=function(e){return"bower_components/"+t.builderType+"/property.json"},t.toggleAccordion=function(t,o,n){var i=t.currentTarget,a=e.querySelector(".menu-item.active");i.classList.contains("active")?i.classList.remove("active"):i.classList.add("active"),a&&a.classList.remove("active")},t._onElementsReceived=function(e){t.menu=e.detail.response,setTimeout(function(){dragAndDropSetup()},100)},t.displayInstalledToast=function(){Polymer.dom(e).querySelector("platinum-sw-cache").disabled||Polymer.dom(e).querySelector("#caching-complete").show()},t.addEventListener("dom-change",function(){console.log("Fusion is ready to rock!")}),window.addEventListener("WebComponentsReady",function(){})}(document);